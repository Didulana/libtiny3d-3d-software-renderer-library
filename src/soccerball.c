#include "soccerball.h"
#include <math.h>

#define C0 0.8090169943749474241
#define C1 1.6180339887498948482
#define C2 1.8090169943749474241
#define C3 2.1180339887498948482
#define C4 2.4270509831248422723

static const float verts[60][3] = {
    {  0.5,  0.0,   C4}, {  0.5,  0.0,  -C4}, { -0.5,  0.0,   C4}, { -0.5,  0.0,  -C4},
    {  C4,  0.5,  0.0}, {  C4, -0.5,  0.0}, { -C4,  0.5,  0.0}, { -C4, -0.5,  0.0},
    {  0.0,   C4,  0.5}, {  0.0,   C4, -0.5}, {  0.0,  -C4,  0.5}, {  0.0,  -C4, -0.5},
    { 1.0,   C0,   C3}, { 1.0,   C0,  -C3}, { 1.0,  -C0,   C3}, { 1.0,  -C0,  -C3},
    {-1.0,   C0,   C3}, {-1.0,   C0,  -C3}, {-1.0,  -C0,   C3}, {-1.0,  -C0,  -C3},
    {  C3,  1.0,   C0}, {  C3,  1.0,  -C0}, {  C3, -1.0,   C0}, {  C3, -1.0,  -C0},
    { -C3,  1.0,   C0}, { -C3,  1.0,  -C0}, { -C3, -1.0,   C0}, { -C3, -1.0,  -C0},
    {  C0,   C3,  1.0}, {  C0,   C3, -1.0}, {  C0,  -C3,  1.0}, {  C0,  -C3, -1.0},
    { -C0,   C3,  1.0}, { -C0,   C3, -1.0}, { -C0,  -C3,  1.0}, { -C0,  -C3, -1.0},
    { 0.5,   C1,   C2}, { 0.5,   C1,  -C2}, { 0.5,  -C1,   C2}, { 0.5,  -C1,  -C2},
    {-0.5,   C1,   C2}, {-0.5,   C1,  -C2}, {-0.5,  -C1,   C2}, {-0.5,  -C1,  -C2},
    {  C2,  0.5,   C1}, {  C2,  0.5,  -C1}, {  C2, -0.5,   C1}, {  C2, -0.5,  -C1},
    { -C2,  0.5,   C1}, { -C2,  0.5,  -C1}, { -C2, -0.5,   C1}, { -C2, -0.5,  -C1},
    {  C1,   C2,  0.5}, {  C1,   C2, -0.5}, {  C1,  -C2,  0.5}, {  C1,  -C2, -0.5},
    { -C1,   C2,  0.5}, { -C1,   C2, -0.5}, { -C1,  -C2,  0.5}, { -C1,  -C2, -0.5}
};

static const int faces[][6] = {
    {  0,  2, 18, 42, 38, 14 }, {  1,  3, 17, 41, 37, 13 },
    {  2,  0, 12, 36, 40, 16 }, {  3,  1, 15, 39, 43, 19 },
    {  4,  5, 23, 47, 45, 21 }, {  5,  4, 20, 44, 46, 22 },
    {  6,  7, 26, 50, 48, 24 }, {  7,  6, 25, 49, 51, 27 },
    {  8,  9, 33, 57, 56, 32 }, {  9,  8, 28, 52, 53, 29 },
    { 10, 11, 31, 55, 54, 30 }, { 11, 10, 34, 58, 59, 35 },
    { 12, 44, 20, 52, 28, 36 }, { 13, 37, 29, 53, 21, 45 },
    { 14, 38, 30, 54, 22, 46 }, { 15, 47, 23, 55, 31, 39 },
    { 16, 40, 32, 56, 24, 48 }, { 17, 49, 25, 57, 33, 41 },
    { 18, 50, 26, 58, 34, 42 }, { 19, 43, 35, 59, 27, 51 },
    {  0, 14, 46, 44, 12, -1 }, {  1, 13, 45, 47, 15, -1 },
    {  2, 16, 48, 50, 18, -1 }, {  3, 19, 51, 49, 17, -1 },
    {  4, 21, 53, 52, 20, -1 }, {  5, 22, 54, 55, 23, -1 },
    {  6, 24, 56, 57, 25, -1 }, {  7, 27, 59, 58, 26, -1 },
    {  8, 32, 40, 36, 28, -1 }, {  9, 29, 37, 41, 33, -1 },
    { 10, 30, 38, 42, 34, -1 }, { 11, 35, 43, 39, 31, -1 }
};

static void add_edge(int edges[][2], int* edge_count, int a, int b) {
    if (a > b) { int t = a; a = b; b = t; }
    for (int i = 0; i < *edge_count; ++i)
        if (edges[i][0] == a && edges[i][1] == b) return;
    edges[*edge_count][0] = a;
    edges[*edge_count][1] = b;
    (*edge_count)++;
}

void generate_soccerball(vec3_t vertices[SOCCERBALL_VERTEX_COUNT],
                         int edges[SOCCERBALL_EDGE_MAX][2],
                         int* edge_count) {
    for (int i = 0; i < SOCCERBALL_VERTEX_COUNT; ++i) {
        float x = verts[i][0], y = verts[i][1], z = verts[i][2];
        float len = sqrtf(x*x + y*y + z*z);
        vertices[i] = vec3_init(x/len, y/len, z/len);
    }
    *edge_count = 0;
    for (int f = 0; f < (int)(sizeof(faces)/sizeof(faces[0])); ++f) {
        int n = 0;
        while (n < 6 && faces[f][n] != -1) n++;
        for (int i = 0; i < n; ++i) {
            int a = faces[f][i];
            int b = faces[f][(i+1)%n];
            add_edge(edges, edge_count, a, b);
        }
    }
}
